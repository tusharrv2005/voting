<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Offline Voting System</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
      text-align: center;
      background: linear-gradient(135deg, #74b9ff, #81ecec);
    }
    h1 { font-size: 2rem; margin-bottom: 10px; color: #2d3436; }
    p { font-size: 1.1rem; margin-bottom: 25px; color: #2d3436; }
    .options {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin: 20px auto;
      max-width: 600px;
    }
    .option {
      flex: 1 1 30%;
      min-width: 120px;
      padding: 15px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: bold;
      color: #fff;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .option:nth-child(odd) { background: #0984e3; }
    .option:nth-child(even) { background: #d63031; }
    .option:hover {
      transform: scale(1.05);
      box-shadow: 0px 4px 12px rgba(0,0,0,0.2);
    }
#charts {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 20px;
  margin-top: 30px;
}

canvas {
  background: #fff;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0px 4px 12px rgba(0,0,0,0.1);
  width: 300px;   /* ‚úÖ Fixed size */
  height: 200px;  /* ‚úÖ Equal height */
}

    }
    #status {
      margin-top: 20px;
      font-size: 1.2rem;
      font-weight: bold;
    }
    #resetBtn, .admin-toggle {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      background: #6c5ce7;
      color: white;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    #resetBtn:hover, .admin-toggle:hover { background: #341f97; }

    .admin-container { max-width: 600px; margin: 30px auto; text-align: left; }
    .admin {
      display: none;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0px 4px 15px rgba(0,0,0,0.2);
    }
    .admin h3 { margin-top: 0; }
    .admin input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .admin button {
      background: #00b894;
      margin-top: 10px;
      padding: 8px 15px;
      border: none;
      border-radius: 6px;
      color: white;
      cursor: pointer;
    }
    .admin button:hover { background: #019875; }
    .candidate-list { margin-top: 20px; }
    .candidate-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 10px;
      background: #f1f2f6;
      border-radius: 6px;
      margin-bottom: 5px;
    }
    .delete-btn {
      background: #d63031;
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 6px;
      cursor: pointer;
    }
    .delete-btn:hover { background: #b71540; }
  </style>
</head>
<body>
  <h1 id="pageTitle">Voting System</h1>
  <p id="pageQuestion">Who is your favourite candidate as a Class Representative (CR)?</p>

  <div class="options" id="optionsContainer"></div>

  <h2 id="status"></h2>

  <div id="charts">
    <canvas id="barChart"></canvas>
    <canvas id="pieChart"></canvas>
  </div>

  <button id="resetBtn" onclick="resetVotes()">üîÑ Reset Votes</button>

  <div class="admin-container">
    <button class="admin-toggle" id="toggleBtn"> Admin Panel</button>
    <div class="admin" id="adminPanel">
      <h3>Admin Settings</h3>
      <label>Change Title:</label>
      <input type="text" id="titleInput" placeholder="Enter new title">
      <label>Change Question:</label>
      <input type="text" id="questionInput" placeholder="Enter new question">
      <label>Add Candidate:</label>
      <input type="text" id="candidateInput" placeholder="Candidate name">
      <button onclick="addCandidate()">‚ûï Add Candidate</button>

      <h4>Current Candidates:</h4>
      <div class="candidate-list" id="candidateList"></div>
    </div>
  </div>

  <script>
    // ‚úÖ Load saved data
    let votes = JSON.parse(localStorage.getItem("votes")) || {};
    let candidates = JSON.parse(localStorage.getItem("candidates")) || ["Candidate A", "Candidate B", "Candidate C"];
    let hasVoted = false;

    const optionsContainer = document.getElementById("optionsContainer");
    const titleEl = document.getElementById("pageTitle");
    const questionEl = document.getElementById("pageQuestion");
    const candidateList = document.getElementById("candidateList");

    // Initialize votes if missing
    candidates.forEach(c => { if (!(c in votes)) votes[c] = 0; });

    // Render voting buttons
    function renderOptions() {
      optionsContainer.innerHTML = "";
      candidates.forEach((c, i) => {
        const btn = document.createElement("div");
        btn.className = "option";
        btn.style.background = i % 2 === 0 ? "#0984e3" : "#d63031";
        btn.innerText = c;
        btn.onclick = () => vote(c);
        optionsContainer.appendChild(btn);
      });
    }

    // Render candidate list in admin
    function renderCandidateList() {
      candidateList.innerHTML = "";
      candidates.forEach((c) => {
        const div = document.createElement("div");
        div.className = "candidate-item";
        div.innerHTML = `<span>${c}</span> <button class="delete-btn" onclick="deleteCandidate('${c}')">‚ùå</button>`;
        candidateList.appendChild(div);
      });
    }

    const barCtx = document.getElementById("barChart").getContext("2d");
    const pieCtx = document.getElementById("pieChart").getContext("2d");

    const barChart = new Chart(barCtx, {
      type: "bar",
      data: {
        labels: candidates,
        datasets: [{
          label: "Votes",
          data: candidates.map(c => votes[c]),
          backgroundColor: ["#0984e3", "#d63031", "#00b894", "#6c5ce7", "#fdcb6e"]
        }]
      },
      options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    const pieChart = new Chart(pieCtx, {
      type: "pie",
      data: {
        labels: candidates,
        datasets: [{
          data: candidates.map(c => votes[c]),
          backgroundColor: ["#0984e3", "#d63031", "#00b894", "#6c5ce7", "#fdcb6e"]
        }]
      },
      options: {
        responsive: true,
        plugins: {
          tooltip: {
            callbacks: {
              label: function(context) {
                let total = context.dataset.data.reduce((a,b)=>a+b,0);
                let value = context.raw;
                let percentage = total ? ((value/total)*100).toFixed(1) : 0;
                return `${context.label}: ${value} votes (${percentage}%)`;
              }
            }
          }
        }
      }
    });

    function updateCharts() {
      barChart.data.labels = candidates;
      barChart.data.datasets[0].data = candidates.map(c => votes[c]);
      pieChart.data.labels = candidates;
      pieChart.data.datasets[0].data = candidates.map(c => votes[c]);
      barChart.update();
      pieChart.update();
      localStorage.setItem("votes", JSON.stringify(votes));
      localStorage.setItem("candidates", JSON.stringify(candidates));
    }

    function vote(candidate) {
      if (hasVoted) {
        document.getElementById("status").innerText = "‚ö†Ô∏è Already voted!";
        return;
      }
      votes[candidate]++;
      hasVoted = true;
      document.getElementById("status").innerText = `‚úÖ Vote recorded for: ${candidate}`;
      updateCharts();
    }

    // Enter key ‚Üí next voter
    document.addEventListener("keydown", function(event) {
      if (event.key === "Enter") {
        hasVoted = false;
        document.getElementById("status").innerText = "üëâ Next voter can now vote.";
      }
    });

    function resetVotes() {
      candidates.forEach(c => votes[c] = 0);
      hasVoted = false;
      document.getElementById("status").innerText = "üîÑ All votes have been reset!";
      updateCharts();
    }

    // ‚úÖ Admin Panel
    document.getElementById("toggleBtn").addEventListener("click", () => {
      const panel = document.getElementById("adminPanel");
      panel.style.display = panel.style.display === "block" ? "none" : "block";
      renderCandidateList();
    });

    function addCandidate() {
      const input = document.getElementById("candidateInput");
      const name = input.value.trim();
      if (name && !candidates.includes(name)) {
        candidates.push(name);
        votes[name] = 0;
        input.value = "";
        renderOptions();
        renderCandidateList();
        updateCharts();
      }
    }

    function deleteCandidate(name) {
      candidates = candidates.filter(c => c !== name);
      delete votes[name];
      renderOptions();
      renderCandidateList();
      updateCharts();
    }

    document.getElementById("titleInput").addEventListener("change", e => {
      titleEl.innerText = e.target.value;
    });

    document.getElementById("questionInput").addEventListener("change", e => {
      questionEl.innerText = e.target.value;
    });

    // Initial render
    renderOptions();
    renderCandidateList();
    updateCharts();
  </script>
</body>
</html>
